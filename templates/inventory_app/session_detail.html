{% extends 'base.html' %}
{% block title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©{% endblock %}

{% block content %}

<style>
.session-box {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    padding: 25px;
    border-radius: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.session-title {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 15px;
}

.session-info {
    font-size: 15px;
    margin-bottom: 5px;
}

.items-table table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.items-table th {
    background: #0d6efd;
    color: white;
    padding: 10px;
}

.items-table td {
    border: 1px solid #ddd;
    padding: 8px;
}

.status-pill {
    padding: 4px 10px;
    color: white;
    border-radius: 15px;
    font-size: 12px;
}

.st-draft { background:#6c757d; }
.st-in_progress { background:#0d6efd; }
.st-submitted_to_supervisor { background:#ffc107; color:#000; }
.st-supervisor_rejected { background:#dc3545; }
.st-supervisor_approved { background:#198754; }
.st-completed { background:#198754; }
</style>


<div class="session-box">

    <div class="session-title">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø¬Ù„Ø³Ø© Ø±Ù‚Ù… {{ session.id }}</div>

    <div class="session-info"><b>Ø§Ù„Ù…ÙˆÙ‚Ø¹:</b> {{ session.region }} - {{ session.city }} - {{ session.building }}</div>
    <div class="session-info"><b>Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ù„Ø³Ø©:</b> {{ session.start_time|date:"Y-m-d H:i" }}</div>

    {% if session.end_time %}
    <div class="session-info"><b>Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©:</b> {{ session.end_time|date:"Y-m-d H:i" }}</div>
    {% endif %}

    <div class="session-info">
        <b>Ø§Ù„Ø­Ø§Ù„Ø©:</b>
        <span class="status-pill st-{{ session.status }}">
            {% if session.status == 'draft' %} Ù…Ø³ÙˆØ¯Ø©
            {% elif session.status == 'in_progress' %} Ù‚ÙŠØ¯ Ø§Ù„Ø¬Ø±Ø¯
            {% elif session.status == 'submitted_to_supervisor' %} Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù
            {% elif session.status == 'supervisor_rejected' %} Ù…Ø±ÙÙˆØ¶Ø© Ù…Ù† Ø§Ù„Ù…Ø´Ø±Ù
            {% elif session.status == 'supervisor_approved' %} Ù…Ø¹ØªÙ…Ø¯Ø© Ù…Ù† Ø§Ù„Ù…Ø´Ø±Ù
            {% elif session.status == 'completed' %} Ù…ÙƒØªÙ…Ù„Ø©
            {% endif %}
        </span>
    </div>

    {% if session.supervisor_comment %}
        <div class="alert alert-danger mt-3">
            <b>Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶:</b> {{ session.supervisor_comment }}
        </div>
    {% endif %}

    <hr>

    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ù„Ø© -->
    {% if session.status == "draft" %}
        <a href="{% url 'inventory_app:live_scan' session.id %}" class="btn btn-warning w-100 mb-2">
            ğŸ”„ Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ø±Ø¯
        </a>
    {% endif %}

    {% if session.status == "in_progress" %}
        <a href="{% url 'inventory_app:live_scan' session.id %}" class="btn btn-primary w-100 mb-2">
            â–¶ Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø¬Ø±Ø¯
        </a>
    {% endif %}

    {% if session.status == "submitted_to_supervisor" %}
        <button class="btn btn-secondary w-100" disabled>
            â³ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ù…Ø´Ø±Ù
        </button>
    {% endif %}

    {% if session.status == "supervisor_rejected" %}
        <a href="{% url 'inventory_app:live_scan' session.id %}" class="btn btn-danger w-100 mb-2">
            â— Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        </a>
    {% endif %}

    {% if session.status == "supervisor_approved" %}
        <a class="btn btn-success w-100" disabled>âœ” Ù…Ø¹ØªÙ…Ø¯Ø©</a>
    {% endif %}

    <hr>

    <!-- ØªØµØ¯ÙŠØ± -->
    <div class="text-center">
        <a href="{% url 'inventory_app:export_session_pdf' session.id %}" class="btn btn-danger mb-2">ğŸ“„ ØªØ­Ù…ÙŠÙ„ PDF</a>
        <a href="{% url 'inventory_app:export_session_excel' session.id %}" class="btn btn-success mb-2">ğŸ“Š ØªØ­Ù…ÙŠÙ„ Excel</a>
    </div>

    <hr>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
    <div class="items-table">
        <h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆÙ„</h4>

        <table>
            <tr>
                <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
                <th>Ø§Ù„ÙˆØµÙ</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ø­</th>
            </tr>

            {% for item in items %}
            <tr>
                <td>{{ item.barcode }}</td>
                <td>{{ item.asset.description }}</td>
                <td>{{ item.get_status_display }}</td>
                <td>
                    {% if item.scanned_at %}
                        {{ item.scanned_at|date:"Y-m-d H:i" }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <hr>

    <a href="/inventory/sessions/" class="btn btn-secondary w-100">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¬Ù„Ø³Ø§Øª</a>

</div>

{% endblock %}
