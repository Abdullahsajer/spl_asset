{% extends "base.html" %}
{% block title %}ØªÙØ§ØµÙŠÙ„ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø±Ø¯ - Ø§Ù„Ù…Ø´Ø±Ù{% endblock %}

{% block content %}

<style>
    .container-box {
        max-width: 1100px;
        margin: 0 auto;
        background: #fff;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
    }

    h2 {
        margin-bottom: 10px;
        font-size: 24px;
        font-weight: bold;
    }

    .info-box {
        margin-bottom: 20px;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 10px;
    }

    .info-line {
        margin-bottom: 5px;
        font-size: 14px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        border-radius: 10px;
        overflow: hidden;
    }

    th {
        background: #0d6efd;
        color: white;
        padding: 10px;
        text-align: center;
    }

    td {
        padding: 8px;
        text-align: center;
        border-bottom: 1px solid #eee;
    }

    tr.found { background: #d4f8d3; }
    tr.missing { background: #f8d7da; }
    tr.newly_added { background: #e8f0fe; }

    .btn-approve, .btn-reject, .btn-export {
        padding: 10px 14px;
        border-radius: 8px;
        border: none;
        font-size: 14px;
        cursor: pointer;
        margin-top: 10px;
        display: inline-block;
        text-decoration: none;
        color: white;
    }

    .btn-approve { background: #198754; width: 100%; }
    .btn-reject { background: #dc3545; width: 100%; }
    .btn-red { background:#dc3545; }
    .btn-green { background:#198754; }

    textarea {
        width: 100%;
        height: 90px;
        margin-top: 10px;
        border-radius: 8px;
        border: 1px solid #ccc;
        padding: 10px;
    }
</style>

<div class="container-box">

    <h2>ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø±Ø¯ Ø±Ù‚Ù… {{ session.id }}</h2>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØµØ¯ÙŠÙ€Ù€Ø± -->
    <div style="margin-bottom: 15px;">
        <a href="{% url 'inventory_app:export_session_pdf' session.id %}" class="btn-export btn-red">ğŸ“„ PDF</a>
        <a href="{% url 'inventory_app:export_session_excel' session.id %}" class="btn-export btn-green">ğŸ“Š Excel</a>
    </div>

    <div class="info-box">
        <div class="info-line"><strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> {{ session.employee.username }}</div>
        <div class="info-line"><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> {{ session.region }}</div>
        <div class="info-line"><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> {{ session.city }}</div>
        <div class="info-line"><strong>Ø§Ù„Ù…Ø¨Ù†Ù‰:</strong> {{ session.building }}</div>
        <div class="info-line"><strong>ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡:</strong> {{ session.start_time|date:"Y-m-d H:i" }}</div>
        <div class="info-line"><strong>ÙˆÙ‚Øª Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</strong> {{ session.end_time|default:"-" }}</div>
        <div class="info-line"><strong>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</strong> {{ session.get_status_display }}</div>
    </div>

    <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆÙ„</h3>

    <table>
        <tr>
            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ø­</th>
        </tr>

        {% for item in items %}
        <tr class="{{ item.status }}">
            <td>{{ item.barcode }}</td>
            <td>{{ item.asset.description }}</td>
            <td>
                {% if item.status == "found" %} âœ” Ù…ÙˆØ¬ÙˆØ¯
                {% elif item.status == "missing" %} âœ˜ Ù…ÙÙ‚ÙˆØ¯
                {% elif item.status == "newly_added" %} ğŸ†• Ø¬Ø¯ÙŠØ¯
                {% endif %}
            </td>
            <td>{{ item.scanned_at|default:"-" }}</td>
        </tr>
        {% endfor %}
    </table>

    <label>Ù…Ù„Ø§Ø­Ø¸Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø±ÙØ¶:</label>
    <textarea id="reject_comment"></textarea>

    <button class="btn-approve" onclick="approveSession()">âœ” Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
    <button class="btn-reject" onclick="rejectSession()">âœ˜ Ø±ÙØ¶ Ø§Ù„Ø¬Ù„Ø³Ø©</button>

</div>

<script>
function approveSession() {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ")) return;

    fetch("{% url 'inventory_app:supervisor_approve_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}", "X-Requested-With": "XMLHttpRequest" }
    })
    .then(r => r.json())
    .then(() => {
        alert("ØªÙ…Øª Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©.");
        window.location.href = "{% url 'inventory_app:supervisor_sessions_list' %}";
    });
}

function rejectSession() {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø±ÙØ¶ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ")) return;

    const comment = document.getElementById("reject_comment").value;

    fetch("{% url 'inventory_app:supervisor_reject_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}", "X-Requested-With": "XMLHttpRequest" },
        body: new URLSearchParams({ "comment": comment })
    })
    .then(r => r.json())
    .then(() => {
        alert("ØªÙ… Ø§Ù„Ø±ÙØ¶.");
        window.location.href = "{% url 'inventory_app:supervisor_sessions_list' %}";
    });
}
</script>

{% endblock %}
