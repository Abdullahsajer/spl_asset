{% extends 'base.html' %}
{% block title %}ØªÙØ§ØµÙŠÙ„ Ø¬Ù„Ø³Ø© - Ø§Ù„Ù…Ø¯ÙŠØ±{% endblock %}

{% block content %}

<style>
    .box {
        background: #fff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        margin-bottom: 20px;
    }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { padding: 10px; border-bottom: 1px solid #eee; text-align: center; }
    th { background: #0d6efd; color: #fff; }
    .btn {
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        border: none;
        font-size: 14px;
        color: white;
        margin-left: 6px;
    }
    .btn-blue { background:#0d6efd; }
    .btn-green { background:#198754; }
    .btn-yellow { background:#ffc107; color:#000; }
    .btn-red { background:#dc3545; }
</style>

<div class="box">
    <h2>ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø±Ù‚Ù… {{ session.id }}</h2>

    <p><strong>Ø§Ù„Ù…ÙˆØ¸Ù:</strong> {{ session.employee.username }}</p>
    <p><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> {{ session.region }}</p>
    <p><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> {{ session.city }}</p>
    <p><strong>Ø§Ù„Ù…Ø¨Ù†Ù‰:</strong> {{ session.building }}</p>
    <p><strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> {{ session.status }}</p>

    {% if session.supervisor_comment %}
    <p><strong>ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ù…Ø´Ø±Ù:</strong> {{ session.supervisor_comment }}</p>
    {% endif %}

    <hr>

    <h3>Ø§Ù„Ø£ØµÙˆÙ„ Ø§Ù„Ù…Ù…Ø³ÙˆØ­Ø©</h3>

    <table>
        <tr>
            <th>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
            <th>Ø§Ù„ÙˆØµÙ</th>
            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            <th>ÙˆÙ‚Øª Ø§Ù„Ù…Ø³Ø­</th>
        </tr>

        {% for i in items %}
        <tr>
            <td>{{ i.barcode }}</td>
            <td>{{ i.asset.description }}</td>
            <td>{{ i.status }}</td>
            <td>{{ i.scanned_at|default:"-" }}</td>
        </tr>
        {% endfor %}
    </table>

    <hr>

    <h3>ğŸ“‚ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¬Ù„Ø³Ø©</h3>

    <div style="margin-top: 12px;">

        <!-- PDF -->
        <a href="{% url 'inventory_app:export_session_pdf' session.id %}" class="btn btn-blue">
            ğŸ“„ ØªØµØ¯ÙŠØ± PDF
        </a>

        <!-- Excel -->
        <a href="{% url 'inventory_app:export_session_excel' session.id %}" class="btn btn-green">
            ğŸ“Š ØªØµØ¯ÙŠØ± Excel
        </a>

        <!-- Reopen -->
        {% if session.status == "supervisor_approved" or session.status == "supervisor_rejected" %}
        <button class="btn btn-yellow" id="reopenBtn">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¬Ù„Ø³Ø©</button>
        {% endif %}

        <!-- Delete -->
        <button class="btn btn-red" id="deleteBtn">ğŸ—‘ Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø©</button>
    </div>

</div>


<script>

// ====== Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¬Ù„Ø³Ø© ======
{% if session.status == "supervisor_approved" or session.status == "supervisor_rejected" %}
document.getElementById("reopenBtn").onclick = function() {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ")) return;

    fetch("{% url 'inventory_app:admin_reopen_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("ØªÙ…Øª Ø¥Ø¹Ø§Ø¯Ø© ÙØªØ­ Ø§Ù„Ø¬Ù„Ø³Ø©.");
            location.reload();
        }
    });
}
{% endif %}


// ====== Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© ======
document.getElementById("deleteBtn").onclick = function() {
    if (!confirm("âš  Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹.")) return;

    fetch("{% url 'inventory_app:admin_delete_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") {
            alert("ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø¨Ù†Ø¬Ø§Ø­.");
            window.location.href = "{% url 'inventory_app:admin_sessions_list' %}";
        }
    });
}

</script>

{% endblock %}
