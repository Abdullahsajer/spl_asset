{% load static %}

<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ø±Ø¯ - Ø¬Ù„Ø³Ø© {{ session.id }}</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
       /* ============================================
      BLUE TECH THEME + AUTO DARK MODE
============================================ */

:root {
    --primary: #0d6efd;
    --primary-light: #4c8dfc;
    --bg-light: #f5f7fa;
    --bg-white: #ffffff;
    --text-dark: #1f1f1f;
    --text-light: #ffffff;
    --border-color: #d7d7d7;
}

/* Dark Mode Auto */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-light: #121212;
        --bg-white: #1e1e1e;
        --text-dark: #e2e2e2;
        --border-color: #333;
    }
}

body {
    font-family: "Cairo", sans-serif;
    background: var(--bg-light);
    margin: 0;
}

/* Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
h2 {
    font-weight: bold;
    color: var(--primary);
}

p {
    color: var(--text-dark);
}

/* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø§Ø³Ø­ */
.scanner-box {
    width: 100%;
    max-width: 420px;
    margin: auto;
    border: 2px solid var(--primary);
    padding: 12px;
    border-radius: 15px;
    background: var(--bg-white);
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
}

video {
    width: 100%;
    border-radius: 8px;
}

/* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø© */
.status-box {
    margin-top: 20px;
    padding: 14px;
    font-size: 17px;
    font-weight: bold;
    display: none;
    border-radius: 10px;
    text-align: center;
}

.status-success { background: #c8f8d0; color: #0e5725; }
.status-warning { background: #fff3cd; color: #8a6d3b; }
.status-danger  { background: #f8d7da; color: #842029; }

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… */
.btn {
    font-size: 15px;
    border-radius: 10px !important;
    padding: 10px 16px;
}

.btn-info {
    background: var(--primary);
    color: white;
    border: none;
}

.btn-info:hover {
    background: var(--primary-light);
}

/* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£ØµÙˆÙ„ */
.items-table {
    margin-top: 25px;
}

.items-table h4 {
    margin-bottom: 12px;
    color: var(--primary);
}

table {
    width: 100%;
    border-collapse: collapse;
    background: var(--bg-white);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
}

th {
    background: var(--primary);
    color: white;
    font-size: 14px;
    padding: 10px;
}

td {
    padding: 8px 10px;
    border-bottom: 1px solid var(--border-color);
    font-size: 14px;
    color: var(--text-dark);
}

tr:hover {
    background: rgba(13,110,253,0.10);
    transition: 0.2s;
}

td a {
    color: var(--primary);
    font-weight: bold;
    text-decoration: none;
}

/* Checkbox */
input[type="checkbox"] {
    width: 18px;
    height: 18px;
}

/* Popup mini window */
#asset-popup {
    animation: fadeScale 0.25s ease;
}

@keyframes fadeScale {
    from { opacity: 0; transform: translate(-50%, -50%) scale(0.85); }
    to   { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

    </style>
    
</head>


<body>

<!-- ======================= -->
<!--         Ø§Ù„Ù‡ÙŠØ¯Ø±         -->
<!-- ======================= -->
{% include 'base.html' %}



<h2 class="text-center">ğŸ“¦ Ø¬Ù„Ø³Ø© Ø§Ù„Ø¬Ø±Ø¯ Ø±Ù‚Ù…: {{ session.id }}</h2>
<p class="text-center">
    {{ session.region }} â€” {{ session.city }} â€” {{ session.building }}
</p>



<!-- Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³Ø­ -->
<div id="statusBox" class="status-box"></div>

<!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø³Ø­ -->
<div class="scanner-box">
    <video id="video" playsinline></video>
</div>
<div class="d-flex justify-content-center gap-3 mt-3 flex-wrap">

    <button class="btn btn-danger px-4 py-2" id="endSessionBtn">
        ğŸ”´ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
    </button>

    <button class="btn btn-warning px-4 py-2" id="saveDraftBtn">
        ğŸ’¾ Ø­ÙØ¸ Ù…Ø¤Ù‚Øª
    </button>

</div>

<!-- Ø¹Ø±Ø¶ Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ø§ØµÙˆÙ„ Ø§Ù„Ù…Ø¬Ø±ÙˆØ¯Ø© ÙˆØ§Ù„Ù…ØªØ¨Ù‚ÙŠÙ‡  -->
<div class="alert alert-primary text-center" style="font-size:14px;">
        <b>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆÙ„:</b> {{ total_items }} |
        <b>ØªÙ… Ø¬Ø±Ø¯Ù‡Ø§:</b> {{ count_found }} |
        <b>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</b> {{ count_remaining }}
    </div>


<div class="d-flex gap-1 mt-1">
        <!-- Ø£Ø²Ø±Ø§Ø± Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø§Ø³Ø­ -->
    <button class="btn btn-info" onclick="openCopyAssetModal()">ğŸ“„ Ù†Ø³Ø® Ø£ØµÙ„</button>
    <!-- ØªÙØ¹ÙŠÙ„ ØµÙˆØª Ø§Ù„Ø¨ÙŠØ¨ -->
    <button class="btn btn-info" id="enableSound" >        ğŸ”Š ØªÙØ¹ÙŠÙ„ ØµÙˆØª </button>

</div>
<div class="text-center">
   
</div>



<!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± -->
<div class="items-table mt-4">
    <h4>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙˆÙ„</h4>


<style>
    table {
        width: 100%;
        border-collapse: collapse;
    }

    table th, table td {
        padding: 8px;
        border: 1px solid #ddd;
    }

    /* Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© */
    .col-barcode { width: 25%; }    /* Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ */
    .col-check   { width: 10%; text-align:center; } /* Ø§Ù„ØªØ´ÙŠÙƒ Ø¨ÙˆÙƒØ³ */
    .col-desc    { width: 50%; }    /* Ø§Ù„ÙˆØµÙ */
    .col-status  { width: 15%; }    /* Ø§Ù„Ø­Ø§Ù„Ø© */
</style>

   
   <table>
    <tr>
        <th class="col-barcode">Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯</th>
        <th class="col-check">ØªØ£ÙƒÙŠØ¯</th>
        <th class="col-desc">Ø§Ù„ÙˆØµÙ</th>
        <th class="col-status">Ø§Ù„Ø­Ø§Ù„Ø©</th>
    </tr>

    {% for item in items %}
    <tr id="row-{{ item.barcode }}">

        <!-- Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
        <td>
            <a href="#" onclick="openAssetMiniWindow('{{ item.barcode }}'); return false;">
                {{ item.barcode }}
            </a>
        </td>

        <!-- Checkbox Ù„Ù„ØªØ£ÙƒÙŠØ¯ -->
        <td>
            <input type="checkbox"
                   onchange="manualConfirm('{{ item.barcode }}')"
                   {% if item.status == 'found' %}checked{% endif %}>
        </td>

        <!-- Ø§Ù„ÙˆØµÙ -->
        <td>{{ item.asset.description }}</td>

        <!-- Ø§Ù„Ø­Ø§Ù„Ø© -->
        <td id="status-{{ item.barcode }}">
            {{ item.get_status_display }}
        </td>
    </tr>
    {% endfor %}
</table>

</div>




<!-- ØµÙˆØª -->
<audio id="beepSound">
    <source src="{% static 'sounds/beep.mp3' %}" type="audio/mpeg">
</audio>


<!-- ZXing -->
<script src="https://unpkg.com/@zxing/library@latest"></script>


<script>
/* ===========================
   Ù†Ø¸Ø§Ù… ØµÙˆØª Ø§Ù„Ø¨ÙŠØ¨
=========================== */
let soundEnabled = false;
const beepSound = document.getElementById("beepSound");

document.getElementById("enableSound").onclick = () => {
    beepSound.play().then(() => {
        soundEnabled = true;
        document.getElementById("enableSound").innerText = "ğŸ”Š ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØµÙˆØª";
    });
};

function playBeep() {
    if (soundEnabled) {
        beepSound.currentTime = 0;
        beepSound.play();
    }
}

/* ===========================
   Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø­Ø§Ù„Ø©
=========================== */
function showStatus(msg, type) {
    const box = document.getElementById("statusBox");
    box.style.display = "block";
    box.className = "status-box " + type;
    box.innerText = msg;

    setTimeout(() => box.style.display = "none", 2000);
}

function updateRow(barcode, text, color) {
    let row = document.getElementById("row-" + barcode);
    let statusCell = document.getElementById("status-" + barcode);

    if (row) row.style.background = color;
    if (statusCell) statusCell.innerText = text;
}

/* ===========================
   ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…Ø³Ø­
=========================== */
async function startScanner() {
    const reader = new ZXing.BrowserBarcodeReader();
    const video = document.getElementById("video");

    const devices = await reader.getVideoInputDevices();
    let camId = devices[0].deviceId;

    reader.decodeFromVideoDevice(camId, video, (result, err) => {
        if (result) {
            const barcode = result.text.trim();

            if (window.lastScan === barcode) return;
            window.lastScan = barcode;
            setTimeout(() => window.lastScan = null, 1500);

            fetch("{% url 'inventory_app:scan_update_api' session.id %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: `barcode=${barcode}`
            })
                .then(r => r.json())
                .then(data => {
                    playBeep();

                    if (data.status === "found") {
                        showStatus("âœ” ØªÙ…Øª Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©: " + barcode, "status-success");
                        updateRow(barcode, "Ù…ÙˆØ¬ÙˆØ¯", "#d4edda");
                    }
                    else if (data.status === "not_in_list") {
                        showStatus("â— Ø§Ù„Ø£ØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "status-warning");
                        showAddNewAssetModal(barcode);
                    }
                });
        }
    });
}
startScanner();


/* ===========================
   Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©
=========================== */
document.getElementById("endSessionBtn").onclick = function () {
    if (!confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©ØŸ")) return;

    fetch("{% url 'inventory_app:close_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" }
    })
        .then(r => r.json())
        .then(data => {
            alert("âœ” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø©");
            window.location.href = "/";
        });
};


/* ===========================
   Ù†Ø§ÙØ°Ø© Ù†Ø³Ø® Ø£ØµÙ„ Copy Modal
=========================== */
function openCopyAssetModal() {
    new bootstrap.Modal(document.getElementById("copyAssetModal")).show();
}

document.getElementById("scanCopyBtn").onclick = function () {
    document.getElementById("copyCameraBox").style.display = "block";

    const reader = new ZXing.BrowserBarcodeReader();
    reader.decodeFromVideoDevice(null, "copyVideo", (result, err) => {
        if (result) {
            document.getElementById("copySourceBarcode").value = result.text.trim();
            fetchCopyAsset();
            reader.reset();
        }
    });
};

function fetchCopyAsset() {
    let barcode = document.getElementById("copySourceBarcode").value.trim();

    fetch(`/api/assets/get/${barcode}/`)
        .then(r => r.json())
        .then(data => {
            if (data.status === "not_found") {
                alert("âŒ Ø§Ù„Ø£ØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
                return;
            }

            document.getElementById("copyAssetInfo").style.display = "block";
            document.getElementById("saveCopyAssetBtn").style.display = "inline-block";

            document.getElementById("info_asset_code").innerText = data.asset_code;
            document.getElementById("info_description").innerText = data.description;
            document.getElementById("info_category").innerText = data.main_category;
            document.getElementById("info_subcategory").innerText = data.sub_category;
        });
}

document.getElementById("saveCopyAssetBtn").onclick = function () {
    let form = new FormData();

    form.append("source_barcode", document.getElementById("copySourceBarcode").value);
    form.append("new_barcode", document.getElementById("new_barcode").value);
    form.append("custodian_name", document.getElementById("new_custodian_name").value);
    form.append("custodian_number", document.getElementById("new_custodian_number").value);
    form.append("custodian_type", document.getElementById("new_custodian_type").value);
    form.append("csrfmiddlewaretoken", "{{ csrf_token }}");

    fetch("{% url 'inventory_app:add_new_asset_api' session.id %}", {
        method: "POST",
        body: form
    })
        .then(r => r.json())
        .then(data => {
            alert("âœ” ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£ØµÙ„");
            location.reload();
        });
};


/* ===========================
   Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„ Ø¬Ø¯ÙŠØ¯
=========================== */
function showAddNewAssetModal(barcode) {
    document.getElementById("addAssetModal").style.display = "block";
    document.getElementById("newBarcodeText").innerText = barcode;
    document.getElementById("saveNewAsset").onclick = function () {
        let form = new FormData();

        form.append("barcode", barcode);
        form.append("asset_code", document.getElementById("newAssetCode").value);
        form.append("description", document.getElementById("newDescription").value);
        form.append("category", document.getElementById("newCategory").value);
        form.append("subcategory", document.getElementById("newSubcategory").value);
        form.append("condition", document.getElementById("newCondition").value);
        form.append("csrfmiddlewaretoken", "{{ csrf_token }}");

        fetch("{% url 'inventory_app:add_new_asset_api' session.id %}", {
            method: "POST",
            body: form
        })
            .then(r => r.json())
            .then(data => {
                alert("âœ” ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£ØµÙ„");
                location.reload();
            });
    };
}

function closeAddModal() {
    document.getElementById("addAssetModal").style.display = "none";
}
</script>

<script>
/* ===========================
      Ù„Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ù‚Øª
=========================== */
document.getElementById("saveDraftBtn").onclick = function () {
    fetch("{% url 'inventory_app:save_draft_session' session.id %}", {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" }
    })
    .then(r => r.json())
    .then(data => {
        alert("âœ” ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ù…Ø¤Ù‚ØªØ§Ù‹");
        window.location.href = "/";
    });
};
</script>


<!-- ============================= -->
<!-- Ù†Ø§ÙØ°Ø© Ù†Ø³Ø® Ø£ØµÙ„ (Copy Modal) -->
<!-- ============================= -->

<div class="modal fade" id="copyAssetModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">ğŸ“„ Ù†Ø³Ø® Ø£ØµÙ„</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <label>Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„</label>
                <div class="input-group mb-3">
                    <input type="text" id="copySourceBarcode" class="form-control">
                    <button class="btn btn-secondary" id="scanCopyBtn">ğŸ“· Ù…Ø³Ø­</button>
                </div>

                <div id="copyCameraBox" style="display:none;">
                    <video id="copyVideo" style="width:100%;border-radius:8px;border:2px solid #007bff;"></video>
                </div>

                <div id="copyAssetInfo" style="display:none;" class="mt-3">
                    <p><b>Ø§Ù„Ø±Ù…Ø²:</b> <span id="info_asset_code"></span></p>
                    <p><b>Ø§Ù„ÙˆØµÙ:</b> <span id="info_description"></span></p>
                    <p><b>Ø§Ù„ÙØ¦Ø©:</b> <span id="info_category"></span></p>
                    <p><b>Ø§Ù„ÙØ±Ø¹ÙŠØ©:</b> <span id="info_subcategory"></span></p>

                    <hr>

                    <input type="text" id="new_barcode" class="form-control mb-2" placeholder="Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯">
                    <input type="text" id="new_custodian_name" class="form-control mb-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©">
                    <input type="text" id="new_custodian_number" class="form-control mb-2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©">
                    <input type="text" id="new_custodian_type" class="form-control mb-2" placeholder="Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‡Ø¯Ø©">
                </div>

            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                <button class="btn btn-success" id="saveCopyAssetBtn" style="display:none;">âœ” Ø¥Ù†Ø´Ø§Ø¡ Ø£ØµÙ„ Ø¬Ø¯ÙŠØ¯</button>
            </div>

        </div>
    </div>
</div>


<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„ Ø¬Ø¯ÙŠØ¯ -->
<div id="addAssetModal" style="
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.5); padding-top:80px;">
    <div style="background:white; width:90%; max-width:400px; margin:auto; padding:20px; border-radius:10px;">

        <h4>â• Ø¥Ø¶Ø§ÙØ© Ø£ØµÙ„ Ø¬Ø¯ÙŠØ¯</h4>
        <p>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯: <span id="newBarcodeText"></span></p>

        <input id="newAssetCode" class="form-control mb-2" placeholder="Ø±Ù…Ø² Ø§Ù„Ø£ØµÙ„">
        <input id="newDescription" class="form-control mb-2" placeholder="Ø§Ù„ÙˆØµÙ">
        <input id="newCategory" class="form-control mb-2" placeholder="Ø§Ù„ÙØ¦Ø©">
        <input id="newSubcategory" class="form-control mb-2" placeholder="Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©">
        <input id="newCondition" class="form-control mb-2" placeholder="Ø§Ù„Ø­Ø§Ù„Ø©">

        <button id="saveNewAsset" class="btn btn-success w-100 mt-2">Ø­ÙØ¸</button>
        <button onclick="closeAddModal()" class="btn btn-secondary w-100 mt-2">Ø¥Ù„ØºØ§Ø¡</button>
    </div>
</div>


<!-- Bootstrap -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div id="miniAssetPopup" style="
    display:none;
    position:fixed;
    top:20%;
    left:50%;
    transform:translateX(-50%);
    background:white;
    width:320px;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 12px rgba(0,0,0,0.2);
    z-index:9999;
">
    <h4>ğŸ” ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ØµÙ„</h4>
    <p><b>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</b> <span id="mini_barcode"></span></p>
    <p><b>Ø§Ù„ÙˆØµÙ:</b> <span id="mini_description"></span></p>
    <p><b>Ø§Ù„ÙØ¦Ø©:</b> <span id="mini_category"></span></p>
    <p><b>Ø§Ù„ÙØ±Ø¹ÙŠØ©:</b> <span id="mini_sub"></span></p>

    <button onclick="closeMiniPopup()" class="btn btn-secondary w-100 mt-2">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>function openAssetDetails(barcode) {

    fetch(`/inventory/api/assets/get/${barcode}/`)
        .then(r => r.json())
        .then(data => {

            if (data.status === "not_found") {
                alert("âŒ Ù‡Ø°Ø§ Ø§Ù„Ø£ØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                return;
            }

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById("d_asset_code").innerText = data.asset_code;
            document.getElementById("d_barcode").innerText = data.barcode;
            document.getElementById("d_description").innerText = data.description;

            document.getElementById("d_main_category").innerText = data.main_category;
            document.getElementById("d_type").innerText = data.type;
            document.getElementById("d_sub_category").innerText = data.sub_category;

            document.getElementById("d_region").innerText = data.region;
            document.getElementById("d_city").innerText = data.city;
            document.getElementById("d_building").innerText = data.building;

            document.getElementById("d_status_text").innerText = data.status_text;
            document.getElementById("d_condition").innerText = data.condition;

            document.getElementById("d_custodian_name").innerText = data.custodian_name;
            document.getElementById("d_custodian_number").innerText = data.custodian_number;
            document.getElementById("d_custodian_type").innerText = data.custodian_type;

            // ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©
            new bootstrap.Modal(document.getElementById("assetDetailModal")).show();
        });
}
</script>
<!-- ========================= -->
<!-- Ù†Ø§ÙØ°Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ØµÙ„        -->
<!-- ========================= -->
<div class="modal fade" id="assetDetailModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ØµÙ„</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body">

                <p><b>Ø±Ù…Ø² Ø§Ù„Ø£ØµÙ„:</b> <span id="d_asset_code"></span></p>
                <p><b>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</b> <span id="d_barcode"></span></p>
                <p><b>Ø§Ù„ÙˆØµÙ:</b> <span id="d_description"></span></p>

                <hr>

                <p><b>Ø§Ù„ÙØ¦Ø©:</b> <span id="d_main_category"></span></p>
                <p><b>Ø§Ù„Ù†ÙˆØ¹:</b> <span id="d_type"></span></p>
                <p><b>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©:</b> <span id="d_sub_category"></span></p>

                <hr>

                <p><b>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</b> <span id="d_region"></span></p>
                <p><b>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</b> <span id="d_city"></span></p>
                <p><b>Ø§Ù„Ù…Ø¨Ù†Ù‰:</b> <span id="d_building"></span></p>

                <hr>

                <p><b>Ø­Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„:</b> <span id="d_status_text"></span></p>
                <p><b>Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:</b> <span id="d_condition"></span></p>

                <hr>

                <p><b>Ø§Ø³Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©:</b> <span id="d_custodian_name"></span></p>
                <p><b>Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‡Ø¯Ø©:</b> <span id="d_custodian_number"></span></p>
                <p><b>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‡Ø¯Ø©:</b> <span id="d_custodian_type"></span></p>

            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
            </div>

        </div>
    </div>
</div>
<script>
function openAssetMiniWindow(barcode) {

    fetch(`/inventory/api/assets/get/${barcode}/`)
        .then(r => r.json())
        .then(data => {

            if (data.status === "not_found") {
                alert("âŒ Ø§Ù„Ø£ØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
                return;
            }

            // Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ù…ØµØºØ±Ø©
            let box = document.createElement("div");
            box.style.position = "fixed";
            box.style.top = "50%";
            box.style.left = "50%";
            box.style.transform = "translate(-50%, -50%)";
            box.style.background = "white";
            box.style.padding = "20px";
            box.style.borderRadius = "12px";
            box.style.boxShadow = "0 4px 15px rgba(0,0,0,0.3)";
            box.style.width = "320px";
            box.style.zIndex = "9999";
            box.style.textAlign = "right";
            box.id = "asset-popup";

            box.innerHTML = `
                <h3 style="margin-bottom:10px;">ğŸ“„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ØµÙ„</h3>

                <p><b>Ø±Ù…Ø² Ø§Ù„Ø£ØµÙ„:</b> ${data.asset_code}</p>
                <p><b>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯:</b> ${barcode}</p>
                <p><b>Ø§Ù„ÙˆØµÙ:</b> ${data.description}</p>

                <hr>

                <p><b>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</b> ${data.main_category}</p>
                <p><b>Ø§Ù„Ù†ÙˆØ¹:</b> ${data.type}</p>
                <p><b>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©:</b> ${data.sub_category}</p>

                <hr>

                <p><b>Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¹Ù‡Ø¯Ù‡:</b> ${data.custodian_name ?? "-"}</p>
                <p><b>Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠÙ‡:</b> ${data.custodian_number ?? "-"}</p>
                <p><b>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù‡Ø¯Ù‡:</b> ${data.custodian_type ?? "-"}</p>
                <p><b>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„:</b> ${data.phone_number ?? "-"}</p>


                <div style="text-align:center; margin-top:15px;">
                    <button onclick="document.getElementById('asset-popup').remove();" 
                            style="
                                background:#dc3545;
                                padding:8px 18px;
                                border:none;
                                border-radius:6px;
                                color:white;
                                font-size:15px;
                            ">
                        Ø¥ØºÙ„Ø§Ù‚
                    </button>
                </div>
            `;

            document.body.appendChild(box);
        });
}
</script>

<script>
function manualConfirm(barcode) {

    fetch(`/inventory/sessions/{{ session.id }}/manual-confirm/`, {
        method: "POST",
        headers: { "X-CSRFToken": "{{ csrf_token }}" },
        body: JSON.stringify({ barcode: barcode })
    })
    .then(r => r.json())
    .then(data => {
        if (data.status === "ok") {

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø©
            document.getElementById("status-" + barcode).innerText = "Ù…ÙˆØ¬ÙˆØ¯";

            // ØªØ¸Ù„ÙŠÙ„ Ø§Ù„ØµÙ 
            let row = document.getElementById("row-" + barcode);
            row.style.background = "#d4edda";      // Ø£Ø®Ø¶Ø± ÙØ§ØªØ­
            row.style.transition = "0.3s";

        }
    });
}
</script>


</body>
</html>
